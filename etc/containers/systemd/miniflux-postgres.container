[Unit]
Description=Miniflux PostgreSQL
PartOf=miniflux.target

[Container]
ContainerName=miniflux-postgres
Image=ghcr.io/polarix-containers/postgres:18
AutoUpdate=registry

Network=miniflux.network

Volume=/srv/miniflux/postgres:/var/lib/postgresql/18/docker:Z
Volume=/srv/miniflux/postgres_dump:/dump:Z
ReadOnly=true
Mount=type=tmpfs,tmpfs-size=50M,tmpfs-mode=0770,U,noexec,nosuid,nodev,destination=/var/run/postgresql

EnvironmentFile=/srv/miniflux/postgres.env
User=200012
Group=200012

NoNewPrivileges=true
DropCapability=ALL

HealthCmd=pg_isready -U miniflux
HealthInterval=15s
HealthTimeout=5s
Notify=healthy

[Service]
LockPersonality=true
ProtectClock=true
RestrictRealtime=true
RuntimeDirectoryMode=700
SystemCallArchitectures=native
SystemCallFilter=~@obsolete

Restart=always

[Install]
WantedBy=miniflux.target
